!function(){var t,e,i,s,n,o,r,a;(t=n||(n={})).GET_SDK_CONFIG="getSdkConfig",t.IS_EMBEDDED="embed",t.PARENT_DOMAIN="parentDomain",(e=o||(o={})).CONFIG="config",e.CONFIG_REQUESTED="configRequested",(i=r||(r={})).COLOR_MODE="color-mode",i.PLAY_MESSAGE_SOUND="play-message-sound",i.ROOM_NAME="room",i.ROOT_URL="root-url",i.USER_ID="user-id",i.USER_NAME="user-name";let l=t=>{let{data:e}=t;return"object"==typeof e&&null!==e&&"name"in e&&"string"==typeof e.name&&"payload"in e&&"object"==typeof e.payload};(s=a||(a={})).DARK="dark",s.LIGHT="light";let u=Object.values(a).map(String),h=t=>u.includes(t),c=["fullscreen"],g=Object.assign(Object.create(null),{url:"file:///sdk/sdk.ts"}).env.VITE_HOMEPAGE??"https://chitchatter.im/",d=["height","referrerpolicy","sandbox","style","width"];class E extends HTMLElement{static get observedAttributes(){return[...Object.values(r),...d]}get chatConfig(){let t={};this.hasAttribute(r.USER_ID)&&(t.userId=this.getAttribute(r.USER_ID)??""),this.hasAttribute(r.USER_NAME)&&(t.customUsername=this.getAttribute(r.USER_NAME)),t.playSoundOnNewMessage=!!this.hasAttribute(r.PLAY_MESSAGE_SOUND);let e=this.getAttribute(r.COLOR_MODE)??"";return h(e)&&(t.colorMode=e),t}get rootUrl(){return this.getAttribute(r.ROOT_URL)??g}async listenForConfigRequest(){this.stopListeningForConfigRequest(),window.addEventListener("message",this.handleConfigRequestedMessage),this.configRequestExpirationTimout=setTimeout(()=>{console.error("[chitchatter-sdk] configuration was not sent successfully"),this.stopListeningForConfigRequest()},1e4)}updateIframeAttributes(){let{iframe:t}=this,e=encodeURIComponent(this.getAttribute(r.ROOM_NAME)??window.location.href),i=new URLSearchParams({[n.IS_EMBEDDED]:"",[n.GET_SDK_CONFIG]:"",[n.PARENT_DOMAIN]:encodeURIComponent(window.location.origin)}),s=new URL(this.rootUrl);s.pathname=`public/${e}`,s.search=i.toString();let{href:o}=s;for(let e of(o!==t.getAttribute("src")&&t.setAttribute("src",o),d)){let i=this.getAttribute(e);null!==i&&t.setAttribute(e,i)}}connectedCallback(){let t=this.attachShadow({mode:"open"}),{iframe:e}=this;e.style.border="none",e.setAttribute("allow",c.join(";")),t.appendChild(e),e.addEventListener("load",()=>{this.listenForConfigRequest()})}disconnectedCallback(){this.stopListeningForConfigRequest()}attributeChangedCallback(t){this.updateIframeAttributes(),Object.values(r).map(String).includes(t)&&this.sendConfigToChat()}constructor(...t){super(...t),this.configRequestExpirationTimout=null,this.iframe=document.createElement("iframe"),this.sendConfigToChat=()=>{let{iframe:t,rootUrl:e}=this,{origin:i}=new URL(e),s={name:o.CONFIG,payload:this.chatConfig};t.contentWindow?.postMessage(s,i)},this.handleConfigRequestedMessage=t=>{let{rootUrl:e}=this,{origin:i}=new URL(e);i===t.origin&&l(t)&&t.data.name===o.CONFIG_REQUESTED&&(this.sendConfigToChat(),this.stopListeningForConfigRequest())},this.stopListeningForConfigRequest=()=>{window.removeEventListener("message",this.handleConfigRequestedMessage),null!==this.configRequestExpirationTimout&&(clearInterval(this.configRequestExpirationTimout),this.configRequestExpirationTimout=null)}}}window.customElements.define("chat-room",E)}();
//# sourceMappingURL=sdk.js.map
